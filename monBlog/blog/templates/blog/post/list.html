{% extends "base.html" %}

{% block content %}
<!-- Header avec r√©sultats de recherche -->
<header class="py-5 bg-light">
    <div class="container text-center">
        <h1 class="display-4">
            {% if search_query %}
                üîç R√©sultats pour "{{ search_query }}"
            {% elif title %}
                {{ title }}
            {% else %}
                Bienvenue sur mon blog
            {% endif %}
        </h1>
        
        <p class="lead">
            {% if search_query %}
                {{ posts.paginator.count }} article(s) trouv√©(s)
            {% elif current_category %}
                Articles dans la cat√©gorie : {{ current_category.name }}
            {% elif title %}
                {{ title }}
            {% else %}
                D√©couvrez mes derniers articles et astuces
            {% endif %}
        </p>
        
        <!-- Bouton Nouvel article (visible seulement si connect√©) -->
        {% if user.is_authenticated and not title %}
        <div class="mt-3">
            <a href="{% url 'post_create' %}" class="btn btn-success btn-lg">
                ‚úèÔ∏è R√©diger un article
            </a>
        </div>
        {% endif %}
    </div>
</header>

<!-- Main Content -->
<main class="container py-5">
    <!-- Message si aucun r√©sultat -->
    {% if posts.paginator.count == 0 %}
    <div class="text-center py-5">
        <h3>üì≠ Aucun article trouv√©</h3>
        <p class="text-muted">
            {% if search_query %}
                Aucun r√©sultat pour "{{ search_query }}". Essayez d'autres termes.
            {% else %}
                Aucun article n'est disponible pour le moment.
            {% endif %}
        </p>
        <a href="{% url 'post_list' %}" class="btn btn-primary">
            Voir tous les articles
        </a>
    </div>
    {% else %}
    <div class="row g-4">
        <!-- Articles -->
        {% for post in posts %}
        <div class="col-md-6 col-lg-4">
            <div class="card blog-card h-100">
                <!-- Image de l'article (placeholder pour l'instant) -->
                <img src="https://via.placeholder.com/600x400/2c3e50/ffffff?text=Blog" 
                     class="card-img-top" 
                     alt="{{ post.title }}">
                
                <div class="card-body d-flex flex-column">
                    <!-- Cat√©gorie -->
                    {% if post.category %}
                    <span class="badge bg-primary mb-2 align-self-start">
                        {{ post.category.name }}
                    </span>
                    {% endif %}
                    
                    <!-- Titre -->
                    <h5 class="card-title">
                        <a href="{{ post.get_absolute_url }}" class="text-decoration-none text-dark">
                            {{ post.title }}
                        </a>
                    </h5>
                    
                    <!-- Extrait -->
                    <p class="card-text flex-grow-1">
                        {{ post.body|truncatewords:20 }}
                    </p>
                    
                    <!-- Boutons d'action -->
                    <div class="mt-auto">
                        <!-- Bouton Lire plus -->
                        <a href="{{ post.get_absolute_url }}" class="btn btn-read-more">
                            Lire plus
                        </a>
                        
                        <!-- Bouton Modifier (auteur seulement) -->
                        {% if user.is_authenticated and user == post.author %}
                        <a href="{% url 'post_edit' post.slug %}" 
                           class="btn btn-outline-secondary btn-sm ms-1"
                           title="Modifier cet article">
                            ‚úèÔ∏è
                        </a>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Pied de carte -->
                <div class="card-footer text-muted">
                    <small>
                        üìÖ {{ post.publish|date:"d/m/Y" }} 
                        | üë§ {{ post.author.username }}
                        {% if post.status == 'draft' %}
                        | <span class="text-warning">Brouillon</span>
                        {% endif %}
                    </small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Pagination -->
    {% if posts.paginator.num_pages > 1 %}
    <div class="mt-5">
        {% include "blog/layouts/pagination.html" with page=posts %}
    </div>
    {% endif %}

    <!-- Section Cat√©gories (seulement sur la page principale) -->
    {% if not search_query and not title and not current_category %}
    <div class="card mt-5">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">üìÇ Cat√©gories</h5>
        </div>
        <div class="card-body">
            <div class="row">
                {% for cat in categories %}
                <div class="col-sm-6 mb-2">
                    <a href="{% url 'category_post_list' cat.slug %}" 
                       class="text-decoration-none">
                        üìÅ {{ cat.name }}
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</main>
{% endblock %}